// ================================================================
// üîÑ Renovate Configuration
// ================================================================
// Universal dependency automation config for any project type.
// Designed for security-first auto-updates with minimal manual intervention.
//
// üìñ Documentation: https://docs.renovatebot.com
// üéØ Philosophy:
//    - Security updates: immediate auto-merge
//    - Stable releases: wait 3 days before updating
//    - Patch/minor: auto-merge (after stabilization)
//    - Major: manual review (breaking changes)
//    - Dev dependencies: grouped into single PR (less spam)
//
// üîß To adapt for other projects:
//    1. Update enabledManagers (npm, composer, pip, etc.)
//    2. Adjust matchManagers in packageRules
//    3. Customize project-specific ignore rules
// ================================================================

{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",

  // ================================================================
  // üéØ CORE CONFIGURATION
  // ================================================================
  // Base presets define sensible defaults for most projects
  // ================================================================

  "extends": [
    "config:recommended"      // Recommended baseline config
  ],

  // ================================================================
  // ‚è∞ SCHEDULE & TIMING
  // ================================================================
  // Controls when Renovate scans for and creates updates
  //
  // Options:
  // - "at any time" (always active, for testing)
  // - "before 6am on monday" (weekly, low-traffic window)
  // - "after 10pm every weekday" (daily, off-hours)
  // ================================================================

  "schedule": [
    "at any time"    // Weekly check: Monday before 06:00 UTC
  ],

  "timezone": "UTC",          // Use UTC for consistency across environments

  // ================================================================
  // üéõÔ∏è RATE LIMITING
  // ================================================================
  // Prevents PR/MR spam and controls update flow
  //
  // Recommended values:
  // - Small projects: 5-10 concurrent
  // - Medium projects: 10-20 concurrent
  // - Large monorepos: 20-50 concurrent
  // ================================================================

  "prConcurrentLimit": 10,    // Max 10 PRs open at once
  "prHourlyLimit": 0,         // No hourly limit (controlled by concurrent only)

  // ================================================================
  // üîß PACKAGE MANAGERS
  // ================================================================
  // Explicitly enable only the managers you need for better performance.
  // Renovate auto-detects but explicit config is more predictable.
  //
  // Common managers:
  // - gradle, maven (Java/Kotlin)
  // - npm, yarn, pnpm (JavaScript/TypeScript)
  // - composer (PHP)
  // - pip, pipenv, poetry (Python)
  // - bundler (Ruby)
  // - cargo (Rust)
  // - gomod (Go)
  // - docker, dockerfile
  // - github-actions, circleci, gitlab-ci
  //
  // üìù Customize this list for your project stack!
  // ================================================================

  "enabledManagers": [
    "gradle",                 // Java/Kotlin: build.gradle, build.gradle.kts
    "gradle-wrapper",         // Gradle wrapper: gradle/wrapper/gradle-wrapper.properties
    "github-actions"          // GitHub Actions: .github/workflows/*.yml
  ],

  // ================================================================
  // üîê SECURITY SETTINGS
  // ================================================================
  // Stability and security policies for dependency updates
  // ================================================================

  // Wait N days before updating to a new version (except security fixes)
  // This allows time for community to discover critical bugs in new releases
  // Security updates bypass this delay (minimumReleaseAge ignores vulnerabilityAlerts)
  "minimumReleaseAge": "3 days",

  // OSV (Open Source Vulnerabilities) integration
  // Provides additional vulnerability data beyond GitHub Security Advisories
  "osvVulnerabilityAlerts": true,

  // ================================================================
  // ü§ñ AUTO-MERGE CONFIGURATION
  // ================================================================
  // Controls how and when PRs are automatically merged
  //
  // Strategies:
  // 1. platformAutomerge: true
  //    - Uses GitHub/GitLab native auto-merge
  //    - Requires Branch Protection rules
  //    - Waits for required status checks
  //
  // 2. platformAutomerge: false + automergeType: "pr"
  //    - Renovate merges directly via API
  //    - Does NOT require Branch Protection
  //    - Controlled by ignoreTests setting
  //
  // Current config: Strategy 2 (no Branch Protection required)
  // ================================================================

  "automerge": false,             // Don't auto-merge by default (use packageRules)

  "platformAutomerge": false,     // Don't use native GitHub/GitLab auto-merge
                                  // (‚ö†Ô∏è would require Branch Protection)

  "automergeType": "pr",          // Renovate merges PRs directly via API

  "automergeStrategy": "squash",  // Squash commits when merging (clean history)

  "ignoreTests": true,            // Merge immediately without waiting for CI
                                  // Set to false if you want to wait for CI
                                  // (‚ö†Ô∏è requires more complex setup with Branch Protection)

  // ================================================================
  // üì¶ DEPENDENCY UPDATE RULES
  // ================================================================
  // Fine-grained policies per dependency type, ecosystem, or version bump
  //
  // Rule matching is based on:
  // - matchManagers: which package manager (gradle, npm, pip, etc.)
  // - matchUpdateTypes: version bump type (major, minor, patch)
  // - matchPackageNames: specific package names
  // - matchPackagePatterns: regex pattern for package names
  // - matchDepTypes: dependency type (dependencies, devDependencies, etc.)
  //
  // Rules are evaluated top-to-bottom; later rules override earlier ones
  // ================================================================

  "packageRules": [

    // ================================================================
    // üîÑ UPDATE CHANNELS (Patch/Minor/Major)
    // ================================================================
    // Define auto-merge behavior per semantic version bump type
    // ================================================================

    {
      "description": "üü¢ Patch updates: auto-merge (bug fixes, backwards-compatible)",
      "matchUpdateTypes": ["patch"],
      "automerge": true,
      // Examples: 1.2.3 ‚Üí 1.2.4, 2.0.0 ‚Üí 2.0.1
      // Should be safe to auto-merge (except for known buggy releases)
    },

    {
      "description": "üü° Minor updates: auto-merge (new features, backwards-compatible)",
      "matchUpdateTypes": ["minor"],
      "automerge": true,
      // Examples: 1.2.0 ‚Üí 1.3.0, 2.0.0 ‚Üí 2.1.0
      // Usually safe if project follows semantic versioning
    },

    {
      "description": "üî¥ Major updates: manual review (breaking changes expected)",
      "matchUpdateTypes": ["major"],
      "automerge": false,
      // Examples: 1.0.0 ‚Üí 2.0.0, 2.5.3 ‚Üí 3.0.0
      // Requires manual review: API changes, deprecations, migrations
    },

    // ================================================================
    // üì¶ DEV / TEST DEPENDENCIES GROUPING
    // ================================================================
    // Group all development/test dependencies into a single PR to
    // reduce noise. This is generic and can be adapted per ecosystem.
    //
    // Notes:
    // - matchDepTypes values are manager-specific.
    // - For npm:        devDependencies, optionalDependencies (etc.)
    // - For Composer:   require-dev
    // - For Gradle:     configuration names (testImplementation, etc.)
    // - For Maven:      test, provided (depending on setup)
    //
    // Adjust the list below to match your actual stack.
    // ================================================================
    {
      "description": "üì¶ Group all dev/test dependencies into a single PR",
      "matchDepTypes": [
        // Node.js / npm / yarn
        "devDependencies",
        "optionalDependencies",

        // PHP / Composer
        "require-dev",

        // Generic "test" buckets
        "test",
        "testDependencies",

        // Gradle configurations used for tests/dev
        "testCompileOnly",
        "testImplementation",
        "testRuntimeOnly",
        "testAnnotationProcessor"
      ],
      "groupName": "Dev / Test dependencies",
      "groupSlug": "dev-test-deps",
      // Do NOT split by major/minor/patch inside this group:
      "separateMajorMinor": false,
      "separateMinorPatch": false
    },

    // ================================================================
    // üö® SECURITY UPDATES
    // ================================================================
    // Vulnerability fixes bypass stabilization delay and auto-merge immediately
    // ================================================================

    {
      "description": "üö® Security: bypass minimumReleaseAge and auto-merge immediately",
      "matchUpdateTypes": ["patch", "minor"],
      "matchDatasources": ["*"],
      // Override minimumReleaseAge for security fixes
      "minimumReleaseAge": "0 days",
      "automerge": true,
      // Note: vulnerabilityAlerts.automerge (below) handles security updates,
      // but this rule ensures patch/minor security fixes merge immediately
    },

    // ================================================================
    // üí¨ COMMIT MESSAGE FORMATTING
    // ================================================================
    // Customize commit messages per package manager
    //
    // Default format (with semanticCommits: enabled):
    //   "chore(deps): update dependency foo to v2.0.0"
    //
    // Custom format (with semanticCommits: disabled):
    //   "[Manager] Update dependency foo to v2.0.0"
    //
    // üìù Adapt these rules for your package managers:
    //    - Gradle ‚Üí [Gradle]
    //    - npm ‚Üí [npm]
    //    - Composer ‚Üí [Composer]
    //    - pip ‚Üí [Python]
    // ================================================================

    {
      "description": "üí¨ Gradle: custom commit message prefix",
      "matchManagers": ["gradle", "gradle-wrapper"],
      "commitMessagePrefix": "[Gradle] ",
      "semanticCommits": "disabled",
      // Example: "[Gradle] Update dependency com.google.guava:guava to v32.0.0"
    },

    {
      "description": "üí¨ GitHub Actions: custom commit message prefix",
      "matchManagers": ["github-actions"],
      "commitMessagePrefix": "[GitHub Actions] ",
      "semanticCommits": "disabled",
      // Example: "[GitHub Actions] Update actions/checkout action to v4.2.0"
    },

    // ================================================================
    // üéØ PROJECT-SPECIFIC RULES
    // ================================================================
    // Custom policies for specific dependencies in this project
    //
    // üìù These are project-specific examples. Customize or remove for your project:
    //    - Ignore unstable/breaking dependencies
    //    - Pin specific versions
    //    - Group related updates
    // ================================================================

    {
      "description": "üõ°Ô∏è Project-specific: ignore patch/minor for specific package",
      "matchManagers": ["gradle"],
      "matchPackageNames": [
        "com.sk89q.worldguard:worldguard-bukkit"
        // Ignore minor/patch updates for a dependency
        // that frequently breaks compatibility despite semantic versioning
      ],
      "matchUpdateTypes": ["patch", "minor"],
      "enabled": false,
      // Only notify about major updates (potential breaking changes)
    },
  ],

  // ================================================================
  // üîê VULNERABILITY ALERTS
  // ================================================================
  // GitHub/GitLab Security Advisories integration
  // Auto-merge security fixes to minimize exposure window
  //
  // Sources:
  // - GitHub Security Advisories
  // - OSV Database (if osvVulnerabilityAlerts: true)
  // - npm audit / Snyk / Dependabot (if enabled)
  // ================================================================

  "vulnerabilityAlerts": {
    "enabled": true,              // Enable security vulnerability detection
    "automerge": true,            // Auto-merge security updates immediately
                                  // Security updates bypass minimumReleaseAge and merge ASAP
                                  // This prioritizes security over stability
  }
}